<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG ë°°í‹€ë¡œì–„ (ê°œì¸ì „/ì´/ìƒì  ì‹œë®¬ë ˆì´ì…˜)</title>
    <style>
        body {
            font-family: 'Consolas', monospace;
            background-color: #282c34;
            color: #abb2bf;
            margin: 20px;
        }
        #game-log {
            height: 300px;
            overflow-y: scroll;
            border: 1px solid #61afef;
            padding: 10px;
            margin-bottom: 20px;
            background-color: #1e2127;
        }
        .player-name { font-weight: bold; color: #e5c07b; }
        .highlight { color: #61afef; font-weight: bold; }
        .damage { color: #f99157; }
        .heal { color: #98c379; }
        .money { color: #ffe066; }
        .win { color: #56b6c2; font-size: 1.2em; }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        .player-card {
            background-color: #3e4451;
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid #61afef;
        }
        .active-player {
            border: 3px solid #e06c75;
            box-shadow: 0 0 10px #e06c75;
        }
        button {
            padding: 8px 12px;
            margin: 5px 5px 5px 0;
            cursor: pointer;
            background-color: #5c6370;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background-color: #4b525b;
        }
        #shop-display {
            border: 1px solid #e5c07b;
            padding: 10px;
            background-color: #2c313a;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>

    <h1>ğŸ”« RPG ë°°í‹€ë¡œì–„ ê°œì¸ì „ (ìµœí›„ì˜ 1ì¸) âš”ï¸</h1>
    <p>ê°œì¸ì „ ë°°í‹€ë¡œì–„ ì‹œë®¬ë ˆì´ì…˜: ì•„ì´í…œì„ ì–»ê³ , ì´ì„ êµ¬ë§¤í•˜ì—¬ ìµœí›„ì˜ 1ì¸ì´ ë˜ì„¸ìš”!</p>

    <div id="game-log">ê²Œì„ ì‹œì‘!</div>

    <div id="current-player-info"></div>

    <div id="shop-display"></div>
    
    <h2 id="action-header">í–‰ë™ ì„ íƒ:</h2>
    <div id="action-buttons">
        </div>

    <script>
        // --- ê²Œì„ ë°ì´í„° ---
        const PLAYER_COUNT = 6;
        const INITIAL_HP = 150;
        const INITIAL_MONEY = 300;
        const players = {};
        let activePlayerId = null; // í˜„ì¬ í„´ì„ ê°€ì§„ í”Œë ˆì´ì–´ ID
        let gameActive = true;
        let turnCounter = 0;

        const guns = [
            { id: 'pistol', name: "ê¶Œì´", baseDamage: 15, cost: 0, range: 1, info: "ê¸°ë³¸ ë¬´ê¸°" },
            { id: 'shotgun', name: "íŒí”„ ìƒ·ê±´", baseDamage: 45, cost: 150, range: 0.5, info: "ê·¼ê±°ë¦¬ ê°•ë ¥" },
            { id: 'ar', name: "ëŒê²© ì†Œì´", baseDamage: 30, cost: 250, range: 2, info: "ì¤‘ê±°ë¦¬ ê· í˜•" },
            { id: 'sniper', name: "ì €ê²©ì´", baseDamage: 80, cost: 500, range: 3, info: "ì¥ê±°ë¦¬ ê³ ë°ë¯¸ì§€" }
        ];

        const items = [
            { id: 'medkit', name: "êµ¬ê¸‰ ìƒì", effect: { hp: 75 }, cost: 100, info: "ì²´ë ¥ ëŒ€ëŸ‰ íšŒë³µ" },
            { id: 'shield', name: "ë¯¸ë‹ˆ ë³´í˜¸ë§‰", effect: { defense: 5 }, cost: 80, info: "ë°©ì–´ë ¥ ì˜êµ¬ ì¦ê°€" },
            { id: 'cash', name: "í˜„ê¸ˆ ë­‰ì¹˜", effect: { money: 150 }, cost: 0, info: "íƒìƒ‰ìœ¼ë¡œë§Œ íšë“" }
        ];

        // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---

        function logMessage(message) {
            const log = document.getElementById('game-log');
            log.innerHTML += `<div>[${turnCounter}í„´] ${message}</div>`;
            log.scrollTop = log.scrollHeight;
        }

        function updateStatusDisplay() {
            let statusHTML = '<h2>í”Œë ˆì´ì–´ í˜„í™©:</h2><div class="status-grid">';
            Object.values(players).forEach(p => {
                const activeClass = p.id === activePlayerId ? 'active-player' : '';
                statusHTML += `
                    <div class="player-card ${activeClass}">
                        <span class="player-name">${p.name}</span> (${p.id})
                        <br>HP: <span class="${p.hp < 50 ? 'damage' : 'heal'}">${p.hp}</span>/${INITIAL_HP} | 
                        ë°©ì–´ë ¥: <span class="highlight">${p.defense}</span>
                        <br>ëˆ: <span class="money">${p.money} G</span> | 
                        ì´: <span class="highlight">${p.gun.name}</span>
                        <br><span class="${p.isAlive ? 'heal' : 'damage'}">${p.isAlive ? 'ìƒì¡´' : 'ì‚¬ë§'}</span>
                    </div>
                `;
            });
            statusHTML += '</div>';
            document.getElementById('current-player-info').innerHTML = statusHTML;
        }

        function checkWinCondition() {
            const alivePlayers = Object.values(players).filter(p => p.isAlive);
            
            if (alivePlayers.length <= 1) {
                gameActive = false;
                const winner = alivePlayers[0];
                
                if (winner) {
                    logMessage(`<div class="win">ğŸ† ${winner.name} ë‹˜ì´ ìµœí›„ì˜ ìŠ¹ìê°€ ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ†</div>`);
                } else {
                    logMessage(`<div class="win">ğŸ’€ ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì‚¬ë§í–ˆìŠµë‹ˆë‹¤! (ë¬´ìŠ¹ë¶€) ğŸ’€</div>`);
                }
                
                document.getElementById('shop-display').innerHTML = '';
                document.getElementById('action-header').style.display = 'none';
                document.getElementById('action-buttons').innerHTML = '<button onclick="location.reload()">ìƒˆ ê²Œì„ ì‹œì‘</button>';
                return true;
            }
            return false;
        }

        // --- ê²Œì„ ë¡œì§ ---

        function initializeGame() {
            logMessage("ê²Œì„ì„ ì´ˆê¸°í™”í•˜ê³  í”Œë ˆì´ì–´ë¥¼ ë°°ì¹˜í•©ë‹ˆë‹¤. ìµœí›„ì˜ 1ì¸ì„ ê°€ë¦¬ëŠ” ê°œì¸ì „ì…ë‹ˆë‹¤.");
            const playerNames = ["ë‹¹ì‹ ", "ë ˆì´ë¸", "ìŠ¤í†°", "íƒ±í¬", "ë°”ì´í¼", "ìŠ¤ì½œí”¼ì˜¨"];

            for (let i = 0; i < PLAYER_COUNT; i++) {
                const playerId = `P${i+1}`;
                players[playerId] = {
                    name: playerNames[i],
                    id: playerId,
                    hp: INITIAL_HP,
                    defense: 5 + Math.floor(Math.random() * 3), // 5~7
                    money: INITIAL_MONEY,
                    isAlive: true,
                    gun: guns[0] // ê¸°ë³¸ ê¶Œì´ ì§€ê¸‰
                };
            }
            
            // P1ì€ ì‚¬ìš©ìê°€ ì¡°ì‘í•˜ëŠ” í”Œë ˆì´ì–´
            activePlayerId = 'P' + PLAYER_COUNT; // P1ë¶€í„° ì‹œì‘í•˜ë„ë¡ nextTurnì—ì„œ ì²˜ë¦¬
            
            nextTurn(); 
        }

        function startTurn() {
            if (!gameActive || checkWinCondition()) return;
            
            turnCounter++;
            const playerIds = Object.keys(players);
            
            // ë‹¤ìŒ ìƒì¡´ í”Œë ˆì´ì–´ ì°¾ê¸°
            let index = playerIds.indexOf(activePlayerId);
            do {
                index = (index + 1) % PLAYER_COUNT;
                activePlayerId = playerIds[index];
            } while (!players[activePlayerId].isAlive);

            const activePlayer = players[activePlayerId];

            logMessage(`--- <span class="player-name">${activePlayer.name}</span> ë‹˜ì˜ í„´ì…ë‹ˆë‹¤. (ëˆ: <span class="money">${activePlayer.money} G</span>) ---`);
            
            updateStatusDisplay();
            
            if (activePlayer.id === 'P1') {
                // ì‚¬ìš©ìê°€ ì¡°ì‘í•˜ëŠ” í”Œë ˆì´ì–´
                showPlayerActions();
            } else {
                // AI í”Œë ˆì´ì–´ í„´ (ìë™ ì§„í–‰)
                setTimeout(aiAction, 1500, activePlayer); // 1.5ì´ˆ í›„ AI í–‰ë™
            }
        }

        function showPlayerActions() {
            document.getElementById('shop-display').innerHTML = createShopHTML();
            document.getElementById('action-buttons').innerHTML = `
                <button onclick="takeAction('shop')">ğŸ›’ ìƒì  ì—´ê¸°</button>
                <button onclick="takeAction('search')">ğŸ—ºï¸ íƒìƒ‰ (ëˆ/ì•„ì´í…œ íšë“)</button>
                <button onclick="showAttackTargets()">ğŸ”« ê³µê²© (ëŒ€ìƒ ì„ íƒ)</button>
            `;
        }

        function createShopHTML() {
            const player = players.P1;
            let html = '<h3>ìƒì </h3>';
            html += '<p>ê°€ì§€ê³  ìˆëŠ” ëˆ: <span class="money">' + player.money + ' G</span></p>';
            
            html += '<h4>ì´ê¸° (í˜„ì¬ ì´: ' + player.gun.name + ')</h4>';
            guns.filter(g => g.id !== player.gun.id).forEach(g => {
                html += `<button onclick="buyItem('${g.id}', 'gun')" ${player.money < g.cost ? 'disabled' : ''}>
                            ${g.name} (${g.cost} G) - DMG: ${g.baseDamage} | ${g.info}
                        </button>`;
            });

            html += '<h4>ì•„ì´í…œ</h4>';
            items.filter(i => i.id !== 'cash').forEach(i => {
                html += `<button onclick="buyItem('${i.id}', 'item')" ${player.money < i.cost ? 'disabled' : ''}>
                            ${i.name} (${i.cost} G) - ${i.info}
                        </button>`;
            });
            return html;
        }

        function buyItem(itemId, type) {
            const player = players.P1;
            let item = (type === 'gun') ? guns.find(g => g.id === itemId) : items.find(i => i.id === itemId);
            
            if (player.money >= item.cost) {
                player.money -= item.cost;
                logMessage(`<span class="highlight">${player.name}</span> ë‹˜ì´ <span class="money">${item.cost} G</span>ë¥¼ ì‚¬ìš©í•˜ì—¬ <span class="heal">${item.name}</span>ì„(ë¥¼) êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤.`);
                
                if (type === 'gun') {
                    player.gun = item;
                } else if (item.effect.hp) {
                    const healAmount = item.effect.hp;
                    player.hp = Math.min(INITIAL_HP, player.hp + healAmount);
                } else if (item.effect.defense) {
                    player.defense += item.effect.defense;
                }
                
                updateStatusDisplay();
                // ìƒì  ë‹«ê³  ë‹¤ìŒ í„´ìœ¼ë¡œ
                document.getElementById('shop-display').innerHTML = '';
                nextTurn();

            } else {
                logMessage("ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤!");
            }
        }

        function takeAction(action, targetId = null) {
            if (!gameActive) return;
            const activePlayer = players[activePlayerId];
            
            document.getElementById('shop-display').innerHTML = ''; // ìƒì  ë‹«ê¸°

            if (action === 'search') {
                const roll = Math.random();
                if (roll < 0.7) { // 70% í™•ë¥ ë¡œ ëˆ íšë“
                    const cashItem = items.find(i => i.id === 'cash');
                    const moneyGained = cashItem.effect.money;
                    activePlayer.money += moneyGained;
                    logMessage(`<span class="player-name">${activePlayer.name}</span> ë‹˜ì´ íƒìƒ‰í•˜ì—¬ <span class="money">${moneyGained} G</span>ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.`);
                } else { // 30% í™•ë¥ ë¡œ ì•„ë¬´ê²ƒë„ ì—†ìŒ
                    logMessage(`${activePlayer.name} ë‹˜ì€ ì•„ë¬´ê²ƒë„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ğŸ§­`);
                }
            } else if (action === 'attack' && targetId) {
                attackPlayer(activePlayer.id, targetId);
            } else if (action === 'shop') {
                // ìƒì  ì•¡ì…˜ì€ showPlayerActionsì—ì„œ ì´ë¯¸ ì²˜ë¦¬ë˜ì—ˆìŒ
                return;
            }

            nextTurn();
        }

        function showAttackTargets() {
            const targetsDiv = document.getElementById('action-buttons');
            const activePlayer = players[activePlayerId];
            targetsDiv.innerHTML = 'ê³µê²© ëŒ€ìƒ ì„ íƒ: <br>';
            
            const enemies = Object.values(players).filter(p => p.isAlive && p.id !== activePlayer.id);
            
            if (enemies.length === 0) {
                targetsDiv.innerHTML += 'ê³µê²©í•  ëŒ€ìƒì´ ì—†ìŠµë‹ˆë‹¤.';
                targetsDiv.innerHTML += `<br><button onclick="showPlayerActions()">ëŒì•„ê°€ê¸°</button>`;
                return;
            }
            
            enemies.forEach(p => {
                targetsDiv.innerHTML += `<button onclick="takeAction('attack', '${p.id}')">
                                            ğŸ”« ${p.name} (HP: ${p.hp})
                                        </button>`;
            });
            targetsDiv.innerHTML += `<br><button onclick="showPlayerActions()">ì·¨ì†Œ</button>`;
        }


        function attackPlayer(attackerId, defenderId) {
            const attacker = players[attackerId];
            const defender = players[defenderId];
            const gun = attacker.gun;
            
            if (!defender.isAlive) return;

            // ë°ë¯¸ì§€ ê³„ì‚° (ì´ê¸° ë°ë¯¸ì§€ + ëœë¤ - ë°©ì–´ë ¥)
            const baseDamage = gun.baseDamage;
            let damageTaken = Math.max(1, Math.floor(baseDamage * (0.8 + Math.random() * 0.4) - defender.defense)); 
            
            defender.hp -= damageTaken;
            
            logMessage(`<span class="player-name">${attacker.name}</span> ë‹˜ì´ ${gun.name}ìœ¼ë¡œ <span class="player-name">${defender.name}</span> ë‹˜ì„ ê³µê²©!`);
            logMessage(`<span class="damage">${defender.name}</span> ë‹˜ì´ ${damageTaken} <span class="damage">ë°ë¯¸ì§€</span>ë¥¼ ì…ì—ˆìŠµë‹ˆë‹¤. (í˜„ì¬ HP: ${defender.hp})`);
            
            if (defender.hp <= 0) {
                defender.hp = 0;
                defender.isAlive = false;
                logMessage(`<div class="damage">â˜ ï¸ <span class="player-name">${defender.name}</span> ë‹˜ì´ <span class="highlight">ì œê±°</span>ë˜ì—ˆìŠµë‹ˆë‹¤! â˜ ï¸</div>`);
            }

            updateStatusDisplay();
        }

        function aiAction(aiPlayer) {
            if (!aiPlayer.isAlive) {
                nextTurn();
                return;
            }
            
            const enemies = Object.values(players).filter(p => p.isAlive && p.id !== aiPlayer.id);
            
            // 1. ì²´ë ¥ì´ ë‚®ìœ¼ë©´ íšŒë³µ ì•„ì´í…œ êµ¬ë§¤ ì‹œë„
            if (aiPlayer.hp < 75 && aiPlayer.money >= 100) {
                const medkit = items.find(i => i.id === 'medkit');
                aiPlayer.money -= medkit.cost;
                aiPlayer.hp = Math.min(INITIAL_HP, aiPlayer.hp + medkit.effect.hp);
                logMessage(`<span class="player-name">${aiPlayer.name}</span> (AI) ë‹˜ì´ ìƒì ì—ì„œ êµ¬ê¸‰ ìƒìë¥¼ êµ¬ë§¤í•˜ì—¬ ì²´ë ¥ì„ íšŒë³µí–ˆìŠµë‹ˆë‹¤.`);
                nextTurn();
                return;
            }

            // 2. ëˆì´ ì¶©ë¶„í•˜ë©´ ë” ì¢‹ì€ ì´ êµ¬ë§¤ ì‹œë„ (í˜„ì¬ ì´ë³´ë‹¤ ë¹„ì‹¼ ê²ƒ)
            const currentGunIndex = guns.findIndex(g => g.id === aiPlayer.gun.id);
            const upgradeGun = guns.slice(currentGunIndex + 1).find(g => aiPlayer.money >= g.cost);
            if (upgradeGun) {
                aiPlayer.money -= upgradeGun.cost;
                aiPlayer.gun = upgradeGun;
                logMessage(`<span class="player-name">${aiPlayer.name}</span> (AI) ë‹˜ì´ <span class="money">${upgradeGun.cost} G</span>ë¥¼ ì‚¬ìš©í•˜ì—¬ ${upgradeGun.name}ìœ¼ë¡œ <span class="highlight">ì—…ê·¸ë ˆì´ë“œ</span>í–ˆìŠµë‹ˆë‹¤.`);
                nextTurn();
                return;
            }
            
            // 3. ê³µê²©í•  ì ì´ ìˆë‹¤ë©´ ê³µê²©
            if (enemies.length > 0) {
                // ê°€ì¥ HPê°€ ë‚®ì€ ì  ê³µê²© (ìš°ì„ ìˆœìœ„)
                enemies.sort((a, b) => a.hp - b.hp);
                const target = enemies[0];
                attackPlayer(aiPlayer.id, target.id);
            } 
            // 4. ì ì´ ì—†ë‹¤ë©´ (ìµœí›„ì˜ 1ì¸ì´ ë˜ì—ˆë‹¤ë©´) ë‹¤ìŒ í„´ìœ¼ë¡œ
            else {
                 // ìŠ¹ë¦¬ ì²´í¬
            }
            
            nextTurn();
        }


        function nextTurn() {
            if (!gameActive) return;
            // í„´ ì§„í–‰ì€ startTurnì—ì„œ ì²˜ë¦¬
            setTimeout(startTurn, 100); // ë”œë ˆì´ë¥¼ ì£¼ì–´ ë¡œê·¸ ë©”ì‹œì§€ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆê²Œ í•¨
        }

        // --- ê²Œì„ ì‹œì‘ ---
        initializeGame();
    </script>

</body>
</html>
